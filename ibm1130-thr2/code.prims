# code.prims : mapping from the Forth primitives to IBM 1130 assembly
#
# Copyright (c) 2025 Charles Suresh <romforth@proton.me>
# SPDX-License-Identifier: AGPL-3.0-only
# Please see the LICENSE file for the Affero GPL 3.0 license details

bye	:	b	i	inner
next	: b		innnr
dup	:	mdx	2	-1 ;	ld		tos ;	sto	i	2 ;
drop	:	ld	i	2 ;	sto		tos ;	mdx	2	1 ;
key	:	dup ;	b		rread
emit	:	bsi		rrite ;	drop ;
lit	:	dup ;	b		litrl
neg	:	ld		tos ;	s		tos ;	s		tos ;	sto		tos ;
j	:	mdx	1	1 ;	ld	i	1 ; a	l	1 ; sto	l	1 ;
jnz	:	mdx	1	1 ;	ld	i	1 ;	sto		ofs ;	ld		tos ;	sto		tmp ;	ld	i	2 ;	sto		tos ;	mdx	2	1 ;	ld		tmp ;	bsc		z ; b		bzero ;
jz	:	mdx	1	1 ;	ld	i	1 ;	sto		ofs ;	ld		tos ;	sto		tmp ;	ld	i	2 ;	sto		tos ;	mdx	2	1 ;	ld		tmp ;	bsc		+- ; b		bzero ;
bzero	:	ld		ofs ;	a	l	1 ;	sto	l	1 ;
inc	:	mdm	l	tos,1 ;	nop ;
dec	:	mdm	l	tos,-1 ;	nop ;
inv	:	ld		tos ;	eor		mnus1 ;	sto		tos ;
dip	:	mdx	2	-1 ;	ld		nos ;	sto	i	2 ;
nip	:	ld	i	2 ;	sto		nos ;	mdx	2	1 ;
